<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Switcher Test</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            padding: 40px;
        }
        .test-info {
            background: var(--surface);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid var(--accent);
        }
        #debug-output {
            background: var(--code-bg);
            color: var(--code-text);
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>ü™∑ Language Switcher Test</h1>
    
    <div class="test-info">
        <h2>Test Status</h2>
        <p id="status">Initializing...</p>
        <button onclick="manualTest()" class="button">Manual Trigger</button>
        <button onclick="clearDebug()" class="button secondary">Clear Log</button>
    </div>

    <div class="test-info">
        <h2>Debug Output</h2>
        <div id="debug-output"></div>
    </div>

    <div class="test-info">
        <h2>Expected Behavior</h2>
        <ul>
            <li>Language switcher should appear in top-right corner (or bottom-left on mobile)</li>
            <li>Theme toggle should appear below the language switcher</li>
            <li>Clicking language buttons should change the page language</li>
            <li>Selected language should be highlighted</li>
        </ul>
    </div>

    <script>
        const debugOutput = document.getElementById('debug-output');
        const statusElement = document.getElementById('status');

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugOutput.textContent += `[${timestamp}] ${message}\n`;
            console.log(message);
        }

        function clearDebug() {
            debugOutput.textContent = '';
        }

        function manualTest() {
            log('üîÑ Manual test triggered');
            const translator = window.testTranslator;
            if (translator) {
                log('‚úÖ Translator instance found');
                translator.setupLanguageSwitcher();
                log('üé® setupLanguageSwitcher() called');
                
                const switcher = document.getElementById('language-switcher');
                if (switcher) {
                    log(`‚úÖ Language switcher exists with ${switcher.children.length} buttons`);
                    statusElement.textContent = '‚úÖ Language switcher is working!';
                    statusElement.style.color = 'green';
                } else {
                    log('‚ùå Language switcher not found in DOM');
                    statusElement.textContent = '‚ùå Language switcher failed to create';
                    statusElement.style.color = 'red';
                }
            } else {
                log('‚ùå No translator instance available');
                statusElement.textContent = '‚ùå Translator not initialized';
                statusElement.style.color = 'red';
            }
        }

        // Override console methods to capture output
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        console.log = function(...args) {
            log('LOG: ' + args.join(' '));
            originalLog.apply(console, args);
        };

        console.error = function(...args) {
            log('ERROR: ' + args.join(' '));
            originalError.apply(console, args);
        };

        console.warn = function(...args) {
            log('WARN: ' + args.join(' '));
            originalWarn.apply(console, args);
        };
    </script>

    <script src="js/seo.js"></script>
    <script src="js/translation.js"></script>
    <script>
        // Custom initialization for testing
        document.addEventListener('DOMContentLoaded', async function() {
            log('üé¨ DOM Content Loaded');
            
            // Initialize theme
            log('üé® Initializing theme...');
            const theme = localStorage.getItem('lotus_theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
            log(`‚úÖ Theme set to: ${theme}`);

            // Initialize Translation Service
            log('üåê Creating TranslationService instance...');
            window.testTranslator = new TranslationService();
            log('‚úÖ TranslationService created');

            try {
                log('üì° Attempting to load translations from ./locales/translations.json');
                await window.testTranslator.loadTranslationsFromFile('./locales/translations.json');
                log('‚úÖ Translations loaded successfully');
            } catch (error) {
                log('‚ùå Failed to load translations: ' + error.message);
            }

            // Check if switcher was created
            setTimeout(() => {
                const switcher = document.getElementById('language-switcher');
                const themeToggle = document.getElementById('theme-toggle');
                
                if (switcher) {
                    log(`‚úÖ Language switcher found! Children: ${switcher.children.length}`);
                    statusElement.textContent = '‚úÖ All systems operational';
                    statusElement.style.color = 'green';
                } else {
                    log('‚ùå Language switcher NOT found in DOM');
                    statusElement.textContent = '‚ö†Ô∏è Language switcher missing - use Manual Trigger';
                    statusElement.style.color = 'orange';
                }

                if (themeToggle) {
                    log('‚úÖ Theme toggle found');
                } else {
                    log('‚ö†Ô∏è Theme toggle not found (expected from init.js)');
                }

                log('üìä Test initialization complete');
            }, 1000);
        });
    </script>
</body>
</html>
